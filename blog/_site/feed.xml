<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>something dev</title>
    <description>dgellow&#39;s dev blog</description>
    <link>http://www.webp.ch/blog/</link>
    <atom:link href="http://www.webp.ch/blog/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 05 Nov 2015 19:37:26 +0100</pubDate>
    <lastBuildDate>Thu, 05 Nov 2015 19:37:26 +0100</lastBuildDate>
    <generator>Jekyll v3.0.0</generator>
    
      <item>
        <title>How to use JS modules (CommonJS, AMD and ES6) from ClojureScript</title>
        <description>&lt;blockquote&gt;
  &lt;p&gt;This document is a work in progress. You can report issues &lt;a href=&quot;https://github.com/dgellow/dgellow.github.io/issues&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;JS packages are written in a variety of different and incompatible standards. To only cite the most popular of them you have &lt;a href=&quot;http://wiki.commonjs.org/wiki/CommonJS&quot;&gt;CommonJS&lt;/a&gt; (used by npm), &lt;a href=&quot;http://requirejs.org/docs/whyamd.html&quot;&gt;AMD&lt;/a&gt; and &lt;a href=&quot;http://exploringjs.com/es6/ch_modules.html&quot;&gt;ES6’s modules&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;ClojureScript makes usage of &lt;a href=&quot;https://github.com/clojure/clojurescript/wiki/Google-Closure#dependency-management&quot;&gt;Google Closure for dependency management&lt;/a&gt;, therefore for a js library to be usable from clojurescript it needs to follow &lt;a href=&quot;https://developers.google.com/closure/library/docs/introduction?csw=1#deps&quot;&gt;Closure Library’s conventions&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The ClojureScript compiler offers three ways to use a JS module:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/clojure/clojurescript/wiki/Compiler-Options#libs&quot;&gt;&lt;code&gt;:libs&lt;/code&gt;&lt;/a&gt; for libraries following Closure’s conventions.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/clojure/clojurescript/wiki/Compiler-Options#externs&quot;&gt;&lt;code&gt;:foreign-libs&lt;/code&gt; in combination with &lt;code&gt;:externs&lt;/code&gt;&lt;/a&gt;, can be used for any javascript library. You will need to manually create a js file declaring objects and functions you want to export. It’s what do the &lt;a href=&quot;https://github.com/cljsjs/packages/wiki/Creating-Externs&quot;&gt;cljsjs project&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/clojure/clojurescript/wiki/Compiler-Options#foreign-libs&quot;&gt;&lt;code&gt;:foreign-libs&lt;/code&gt; with &lt;code&gt;:module-type&lt;/code&gt;&lt;/a&gt;, will leverage Closure’s support for common used module standards. It’s the most interesting way to use a js library as you can import them from &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;&lt;code&gt;npm&lt;/code&gt;&lt;/a&gt;. It’s also the least known method as &lt;a href=&quot;https://github.com/clojure/clojurescript/wiki/Google-Summer-of-Code-2015&quot;&gt;it has only be implemented recently&lt;/a&gt; thanks to &lt;a href=&quot;https://github.com/mneise&quot;&gt;Maria Geller&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;js-modules-following-google-closures-conventions&quot;&gt;JS modules following Google Closure’s conventions&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;TODO&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;js-modules-not-following-any-standard&quot;&gt;JS modules not following any standard&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;TODO&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;js-modules-following-commonjs-amd-or-es6&quot;&gt;JS modules following CommonJS, AMD or ES6&lt;/h2&gt;

&lt;p&gt;You will need a recent version of ClojureScript (not sure what was the first version to support the &lt;code&gt;:module-type&lt;/code&gt;, but anything after &lt;code&gt;&quot;1.7.145&quot;&lt;/code&gt; works from my experience).&lt;/p&gt;

&lt;p&gt;I’m using boot but it shouldn’t be too much different with leiningen.&lt;/p&gt;

&lt;p&gt;For this example I will use a CommonJS module called &lt;a href=&quot;https://github.com/dgellow/bailer&quot;&gt;bailer&lt;/a&gt;, available via &lt;code&gt;npm&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;npm install bailer&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The project is structured like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;.
|-- README.md
|-- build
|   &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- main.cljs.edn
|-- build.boot
|-- html
|   &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- index.html
|-- node_modules
|   &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- bailer
|       |-- README.md
|       |-- index.js
|       |-- package.json
|       &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- test.js
&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- src
    &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- com
        &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- foo
            &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- bar
                &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;-- core.cljs&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In the &lt;code&gt;boot.build&lt;/code&gt; we will specify compilers options (it can also be done from &lt;code&gt;*.cljs.edn&lt;/code&gt; files, see &lt;a href=&quot;https://github.com/adzerk-oss/boot-cljs#options&quot;&gt;boot documentation&lt;/a&gt;).&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set-env!&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:source-paths&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;src&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:resource-paths&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;html&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:dependencies&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adzerk/boot-cljs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1.7.48-6&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;org.clojure/clojurescript&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1.7.145&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adzerk.boot-cljs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:refer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cljs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;task-options!&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cljs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:compiler-options&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                     &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:foreign-libs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:file&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;node_modules/bailer/index.js&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                                      &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:provides&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dgellow.bailer&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                                      &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:module-type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:commonjs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]}})&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In &lt;code&gt;src/com/foo/bar/core.cljs&lt;/code&gt;, we have the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ns&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;com.foo.bar.core&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:require&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dgellow.bailer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:refer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;validations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;defn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;js&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:age&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;john.doe@example.org&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;js-debugger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.dir&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;js/console&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;clj-&amp;gt;js&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.-required&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;validations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]}))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We can now build everything and it should works (check the browser dev tool)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;boot cljs&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

</description>
        <pubDate>Thu, 05 Nov 2015 00:00:00 +0100</pubDate>
        <link>http://www.webp.ch/blog/clojurescript/2015/11/05/how-to-js-modules-from-clojurescript.html</link>
        <guid isPermaLink="true">http://www.webp.ch/blog/clojurescript/2015/11/05/how-to-js-modules-from-clojurescript.html</guid>
        
        
        <category>clojurescript</category>
        
      </item>
    
  </channel>
</rss>
